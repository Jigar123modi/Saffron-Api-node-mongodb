{"version":3,"sources":["api/thing/thing.controller.js"],"names":["index","show","create","upsert","patch","destroy","respondWithResult","res","statusCode","entity","status","json","patchUpdates","patches","err","reject","save","removeEntity","remove","then","end","handleEntityNotFound","handleError","send","req","find","exec","catch","findById","params","id","body","_id","findOneAndUpdate","new","setDefaultsOnInsert","runValidators"],"mappings":"AAAA;;;;;;;;;;AAUA;;;;;;;;;;;;;;QAsDgBA,K,GAAAA,K;QAOAC,I,GAAAA,I;QAQAC,M,GAAAA,M;QAOAC,M,GAAAA,M;QAgBAC,K,GAAAA,K;QAYAC,O,GAAAA,O;;AAtGhB;;AACA;;;;;;AAEA,SAASC,iBAAT,CAA2BC,GAA3B,EAAgCC,UAAhC,EAA4C;AACxCA,iBAAaA,cAAc,GAA3B;AACA,WAAO,UAAUC,MAAV,EAAkB;AACrB,YAAIA,MAAJ,EAAY;AACR,mBAAOF,IAAIG,MAAJ,CAAWF,UAAX,EAAuBG,IAAvB,CAA4BF,MAA5B,CAAP;AACH;AACD,eAAO,IAAP;AACH,KALD;AAMH;;AAED,SAASG,YAAT,CAAsBC,OAAtB,EAA+B;AAC3B,WAAO,UAAUJ,MAAV,EAAkB;AACrB,YAAI;AACA,2CAAWA,MAAX,EAAmBI,OAAnB,EAA4B,YAAa,IAAzC;AACH,SAFD,CAEE,OAAOC,GAAP,EAAY;AACV,mBAAO,kBAAQC,MAAR,CAAeD,GAAf,CAAP;AACH;;AAED,eAAOL,OAAOO,IAAP,EAAP;AACH,KARD;AASH;;AAED,SAASC,YAAT,CAAsBV,GAAtB,EAA2B;AACvB,WAAO,UAAUE,MAAV,EAAkB;AACrB,YAAIA,MAAJ,EAAY;AACR,mBAAOA,OAAOS,MAAP,GACFC,IADE,CACG,MAAMZ,IAAIG,MAAJ,CAAW,GAAX,EAAgBU,GAAhB,EADT,CAAP;AAEH;AACJ,KALD;AAMH;;AAED,SAASC,oBAAT,CAA8Bd,GAA9B,EAAmC;AAC/B,WAAO,UAAUE,MAAV,EAAkB;AACrB,YAAI,CAACA,MAAL,EAAa;AACTF,gBAAIG,MAAJ,CAAW,GAAX,EAAgBU,GAAhB;AACA,mBAAO,IAAP;AACH;AACD,eAAOX,MAAP;AACH,KAND;AAOH;;AAED,SAASa,WAAT,CAAqBf,GAArB,EAA0BC,UAA1B,EAAsC;AAClCA,iBAAaA,cAAc,GAA3B;AACA,WAAO,UAAUM,GAAV,EAAe;AAClBP,YAAIG,MAAJ,CAAWF,UAAX,EAAuBe,IAAvB,CAA4BT,GAA5B;AACH,KAFD;AAGH;;AAED;AACO,SAASd,KAAT,CAAewB,GAAf,EAAoBjB,GAApB,EAAyB;AAC5B,WAAO,gBAAMkB,IAAN,GAAaC,IAAb,GACFP,IADE,CACGb,kBAAkBC,GAAlB,EAAuB,GAAvB,CADH,EAEFoB,KAFE,CAEIL,YAAYf,GAAZ,CAFJ,CAAP;AAGH;;AAED;AACO,SAASN,IAAT,CAAcuB,GAAd,EAAmBjB,GAAnB,EAAwB;AAC3B,WAAO,gBAAMqB,QAAN,CAAeJ,IAAIK,MAAJ,CAAWC,EAA1B,EAA8BJ,IAA9B,GACFP,IADE,CACGE,qBAAqBd,GAArB,CADH,EAEFY,IAFE,CAEGb,kBAAkBC,GAAlB,EAAuB,GAAvB,CAFH,EAGFoB,KAHE,CAGIL,YAAYf,GAAZ,CAHJ,CAAP;AAIH;;AAED;AACO,SAASL,MAAT,CAAgBsB,GAAhB,EAAqBjB,GAArB,EAA0B;AAC7B,WAAO,gBAAML,MAAN,CAAasB,IAAIO,IAAjB,EACFZ,IADE,CACGb,kBAAkBC,GAAlB,EAAuB,GAAvB,CADH,EAEFoB,KAFE,CAEIL,YAAYf,GAAZ,CAFJ,CAAP;AAGH;;AAED;AACO,SAASJ,MAAT,CAAgBqB,GAAhB,EAAqBjB,GAArB,EAA0B;AAC7B,QAAIiB,IAAIO,IAAJ,CAASC,GAAb,EAAkB;AACd,sCAAuBR,IAAIO,IAA3B,EAAiC,KAAjC;AACH;AACD,WAAO,gBAAME,gBAAN,CAAuB,EAACD,KAAKR,IAAIK,MAAJ,CAAWC,EAAjB,EAAvB,EAA6CN,IAAIO,IAAjD,EAAuD;AAC1DG,aAAK,IADqD;AAE1D/B,gBAAQ,IAFkD;AAG1DgC,6BAAqB,IAHqC;AAI1DC,uBAAe;AAJ2C,KAAvD,EAKJV,IALI,GAOFP,IAPE,CAOGb,kBAAkBC,GAAlB,EAAuB,GAAvB,CAPH,EAQFoB,KARE,CAQIL,YAAYf,GAAZ,CARJ,CAAP;AASH;;AAED;AACO,SAASH,KAAT,CAAeoB,GAAf,EAAoBjB,GAApB,EAAyB;AAC5B,QAAIiB,IAAIO,IAAJ,CAASC,GAAb,EAAkB;AACd,sCAAuBR,IAAIO,IAA3B,EAAiC,KAAjC;AACH;AACD,WAAO,gBAAMH,QAAN,CAAeJ,IAAIK,MAAJ,CAAWC,EAA1B,EAA8BJ,IAA9B,GACFP,IADE,CACGE,qBAAqBd,GAArB,CADH,EAEFY,IAFE,CAEGP,aAAaY,IAAIO,IAAjB,CAFH,EAGFZ,IAHE,CAGGb,kBAAkBC,GAAlB,CAHH,EAIFoB,KAJE,CAIIL,YAAYf,GAAZ,CAJJ,CAAP;AAKH;;AAED;AACO,SAASF,OAAT,CAAiBmB,GAAjB,EAAsBjB,GAAtB,EAA2B;AAC9B,WAAO,gBAAMqB,QAAN,CAAeJ,IAAIK,MAAJ,CAAWC,EAA1B,EAA8BJ,IAA9B,GACFP,IADE,CACGE,qBAAqBd,GAArB,CADH,EAEFY,IAFE,CAEGF,aAAaV,GAAb,CAFH,EAGFoB,KAHE,CAGIL,YAAYf,GAAZ,CAHJ,CAAP;AAIH","file":"thing.controller.js","sourcesContent":["/**\r\n * Using Rails-like standard naming convention for endpoints.\r\n * GET     /api/things              ->  index\r\n * POST    /api/things              ->  create\r\n * GET     /api/things/:id          ->  show\r\n * PUT     /api/things/:id          ->  upsert\r\n * PATCH   /api/things/:id          ->  patch\r\n * DELETE  /api/things/:id          ->  destroy\r\n */\r\n\r\n'use strict';\r\n\r\nimport {applyPatch} from 'fast-json-patch';\r\nimport Thing from './thing.model';\r\n\r\nfunction respondWithResult(res, statusCode) {\r\n    statusCode = statusCode || 200;\r\n    return function (entity) {\r\n        if (entity) {\r\n            return res.status(statusCode).json(entity);\r\n        }\r\n        return null;\r\n    };\r\n}\r\n\r\nfunction patchUpdates(patches) {\r\n    return function (entity) {\r\n        try {\r\n            applyPatch(entity, patches, /*validate*/ true);\r\n        } catch (err) {\r\n            return Promise.reject(err);\r\n        }\r\n\r\n        return entity.save();\r\n    };\r\n}\r\n\r\nfunction removeEntity(res) {\r\n    return function (entity) {\r\n        if (entity) {\r\n            return entity.remove()\r\n                .then(() => res.status(204).end());\r\n        }\r\n    };\r\n}\r\n\r\nfunction handleEntityNotFound(res) {\r\n    return function (entity) {\r\n        if (!entity) {\r\n            res.status(404).end();\r\n            return null;\r\n        }\r\n        return entity;\r\n    };\r\n}\r\n\r\nfunction handleError(res, statusCode) {\r\n    statusCode = statusCode || 500;\r\n    return function (err) {\r\n        res.status(statusCode).send(err);\r\n    };\r\n}\r\n\r\n// Gets a list of Things\r\nexport function index(req, res) {\r\n    return Thing.find().exec()\r\n        .then(respondWithResult(res, 200))\r\n        .catch(handleError(res));\r\n}\r\n\r\n// Gets a single Thing from the DB\r\nexport function show(req, res) {\r\n    return Thing.findById(req.params.id).exec()\r\n        .then(handleEntityNotFound(res))\r\n        .then(respondWithResult(res, 200))\r\n        .catch(handleError(res));\r\n}\r\n\r\n// Creates a new Thing in the DB\r\nexport function create(req, res) {\r\n    return Thing.create(req.body)\r\n        .then(respondWithResult(res, 201))\r\n        .catch(handleError(res));\r\n}\r\n\r\n// Upserts the given Thing in the DB at the specified ID\r\nexport function upsert(req, res) {\r\n    if (req.body._id) {\r\n        Reflect.deleteProperty(req.body, '_id');\r\n    }\r\n    return Thing.findOneAndUpdate({_id: req.params.id}, req.body, {\r\n        new: true,\r\n        upsert: true,\r\n        setDefaultsOnInsert: true,\r\n        runValidators: true\r\n    }).exec()\r\n\r\n        .then(respondWithResult(res, 200))\r\n        .catch(handleError(res));\r\n}\r\n\r\n// Updates an existing Thing in the DB\r\nexport function patch(req, res) {\r\n    if (req.body._id) {\r\n        Reflect.deleteProperty(req.body, '_id');\r\n    }\r\n    return Thing.findById(req.params.id).exec()\r\n        .then(handleEntityNotFound(res))\r\n        .then(patchUpdates(req.body))\r\n        .then(respondWithResult(res))\r\n        .catch(handleError(res));\r\n}\r\n\r\n// Deletes a Thing from the DB\r\nexport function destroy(req, res) {\r\n    return Thing.findById(req.params.id).exec()\r\n        .then(handleEntityNotFound(res))\r\n        .then(removeEntity(res))\r\n        .catch(handleError(res));\r\n}\r\n"]}