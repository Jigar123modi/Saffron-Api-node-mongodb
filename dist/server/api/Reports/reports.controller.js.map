{"version":3,"sources":["api/Reports/reports.controller.js"],"names":["req","res","next","uniqueId","getAllUser","find","_id","__v","description","password","role","block","exec","allTopUserId","all","map","data","getAllBookingCountTopUser","count","customer_id","$in","contact_no","tmp","user","totalOrder","push","i","length","j","status","json","error","writeLog","eLogLevel","message","toString","getTopUser","allEmployee","getAllBookingOrder","id","total","innerData","productList","teamWiseProductList","teamWise","singleProduct","price","totalBillablePrice","getTotalBillablePrice","response","getOrderStatusReport","orderStatus","getTeamWiseOrderStatusReport"],"mappings":"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","file":"reports.controller.js","sourcesContent":["import Oauth from '../oauth/oauth.model';\r\nimport Booking from '../Booking/Booking.model';\r\nimport {errorJsonResponse, getGuid} from '../../config/commonHelper';\r\nimport Log from '../../config/Log';\r\n\r\nexport async function getTopUser(req, res, next) {\r\n    let uniqueId = getGuid();\r\n    try {\r\n        let getAllUser = await Oauth.find({}, {\r\n            _id: 0,\r\n            __v: 0,\r\n            description: 0,\r\n            password: 0,\r\n            role: 0,\r\n            block: 0,\r\n        }).exec();\r\n        let allTopUserId = [];\r\n        await Promise.all(getAllUser.map(async (data) => {\r\n            const getAllBookingCountTopUser = await Booking.count({customer_id: {$in: data.contact_no}}).exec();\r\n            const tmp = {user: data, totalOrder: getAllBookingCountTopUser};\r\n            allTopUserId.push(tmp);\r\n        }));\r\n        for (let i = 0; i < allTopUserId.length; i++) {\r\n            for (let j = 0; j < allTopUserId.length; j++) {\r\n                if (allTopUserId[i].totalOrder > allTopUserId[j].totalOrder) {\r\n                    const tmp = allTopUserId[i];\r\n                    allTopUserId[i] = allTopUserId[j];\r\n                    allTopUserId[j] = tmp;\r\n                }\r\n            }\r\n        }\r\n        res.status(200).json(allTopUserId);\r\n\r\n    } catch (error) {\r\n        Log.writeLog(Log.eLogLevel.error, '[getTopUser] : ' + JSON.stringify(errorJsonResponse(error.message.toString(), error.message.toString())), uniqueId);\r\n        next(error);\r\n    }\r\n}\r\n\r\nexport async function getTotalBillablePrice(req, res, next) {\r\n    let uniqueId = getGuid();\r\n    try {\r\n        let getAllUser = await Oauth.find({role: 'employee'}, {\r\n            _id: 0,\r\n            __v: 0,\r\n            description: 0,\r\n            password: 0,\r\n            role: 0,\r\n            block: 0,\r\n        }).exec();\r\n        let allEmployee = [];\r\n        await Promise.all(getAllUser.map(async (data) => {\r\n            const getAllBookingOrder = await Booking.find({\"teamWiseProductList.id\": data.id});\r\n            let total = 0;\r\n            getAllBookingOrder.map((innerData) => {\r\n                let productList = innerData.teamWiseProductList.find((teamWise) => teamWise.id === data.id).productList;\r\n                productList.map((singleProduct) => {\r\n                    total += singleProduct.price;\r\n                })\r\n            });\r\n            const tmp = {user: data, totalBillablePrice: total};\r\n            allEmployee.push(tmp);\r\n        }));\r\n\r\n        res.status(200).json(allEmployee);\r\n\r\n    } catch (error) {\r\n        Log.writeLog(Log.eLogLevel.error, '[getTotalBillablePrice] : ' + JSON.stringify(errorJsonResponse(error.message.toString(), error.message.toString())), uniqueId);\r\n        next(error);\r\n    }\r\n}\r\n\r\nexport async function getOrderStatusReport(req, res, next) {\r\n    let uniqueId = getGuid();\r\n    try {\r\n        let response = [];\r\n        let count = await Booking.count({status: \"recent\"}).exec();\r\n        response.push({status: 'recent', total: count});\r\n        count = await Booking.count({status: \"process\"}).exec();\r\n        response.push({status: 'process', total: count});\r\n        count = await Booking.count({status: \"late\"}).exec();\r\n        response.push({status: 'late', total: count});\r\n        count = await Booking.count({status: \"finish\"}).exec();\r\n        response.push({status: 'finish', total: count});\r\n        res.status(200).json(response);\r\n    } catch (error) {\r\n        Log.writeLog(Log.eLogLevel.error, '[getOrderStatusReport] : ' + JSON.stringify(errorJsonResponse(error.message.toString(), error.message.toString())), uniqueId);\r\n        next(error);\r\n    }\r\n}\r\n\r\nexport async function getTeamWiseOrderStatusReport(req, res, next) {\r\n    let uniqueId = getGuid();\r\n    try {\r\n        let response = [];\r\n\r\n        let getAllUser = await Oauth.find({role: 'employee'}, {\r\n            _id: 0,\r\n            __v: 0,\r\n            description: 0,\r\n            password: 0,\r\n            role: 0,\r\n            block: 0,\r\n        }).exec();\r\n\r\n        await Promise.all(getAllUser.map(async (data) => {\r\n            let tmp = {user: data, orderStatus: []};\r\n            let count = await Booking.count({\"teamWiseProductList.id\": data.id, \"teamWiseProductList.orderStatus\":\"waiting\"}).exec();\r\n            tmp.orderStatus.push({status: 'waiting', total: count});\r\n            count = await Booking.count({\"teamWiseProductList.id\": data.id, \"teamWiseProductList.orderStatus\":\"process\"}).exec();\r\n            tmp.orderStatus.push({status: 'process', total: count});\r\n            count = await Booking.count({\"teamWiseProductList.id\": data.id, \"teamWiseProductList.orderStatus\":\"late\"}).exec();\r\n            tmp.orderStatus.push({status: 'late', total: count});\r\n            count = await Booking.count({\"teamWiseProductList.id\": data.id, \"teamWiseProductList.orderStatus\":\"finish\"}).exec();\r\n            tmp.orderStatus.push({status: 'finish', total: count});\r\n            response.push(tmp);\r\n        }));\r\n        res.status(200).json(response);\r\n\r\n    } catch (error) {\r\n        Log.writeLog(Log.eLogLevel.error, '[getTeamWiseOrderStatusReport] : ' + JSON.stringify(errorJsonResponse(error.message.toString(), error.message.toString())), uniqueId);\r\n        next(error);\r\n    }\r\n}\r\n"]}